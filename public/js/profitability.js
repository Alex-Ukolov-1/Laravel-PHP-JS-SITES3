!function(t){var i={};function e(r){if(i[r])return i[r].exports;var s=i[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=t,e.c=i,e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(r,s,function(i){return t[i]}.bind(null,s));return r},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="/",e(e.s=1)}({"/JV1":function(t,i){!function(){function t(t){return parseFloat(t.toFixed(2))}var i=function(t){this.fieldWasChanged=this.fieldWasChanged.bind(this),this.numberFormat=new Intl.NumberFormat("ru-RU",{minimumFractionDigits:2}),this.createResultElement(),this.form=t,t.addEventListener("keyup",this.fieldWasChanged),t.addEventListener("change",this.fieldWasChanged),this.init()};i.prototype={constructor:i,init:function(){Array.prototype.slice.call(this.form.elements).forEach((function(t){"BUTTON"!==t.nodeName&&"BUTTON"!==t.tagName&&"TEXTAREA"!==t.nodeName&&"TEXTAREA"!==t.tagName&&("radio"===t.type&&!1===t.checked||(this[t.name]=parseFloat(t.value)))}),this),this.fullRecalc()},createResultElement:function(){this.resultsEl=document.createElement("div"),this.resultsEl.setAttribute("id","profitability-modal"),document.querySelector("body").appendChild(this.resultsEl)},fieldWasChanged:function(t){this[t.target.name]!==parseFloat(t.target.value)&&(this[t.target.name]=parseFloat(t.target.value),this.fullRecalc())},recalcMain:function(){if(isNaN(this.conversion_factor)||""===this.conversion_factor)return this.unloadingVolume=void 0,this.unloadingPrice=void 0,this.loadingPrice=void 0,void(this.loadingVolume=void 0);this.unloadingVolume=this.unloading_volume,this.unloadingPrice=this.unloading_price,this.loadingVolume=this.loading_volume,this.loadingPrice=this.loading_price,1===this.unloading_volume_type_id&&(this.unloadingVolume=t(this.unloadingVolume/this.conversion_factor)),1===this.unloading_price_type_id&&(this.unloadingPrice=t(this.unloadingPrice/this.conversion_factor)),1===this.loading_price_type_id&&(this.loadingPrice=t(this.loadingPrice/this.conversion_factor)),1===this.loading_volume_type_id&&(this.loadingVolume=t(this.loadingVolume/this.conversion_factor))},calcIntermediateResults:function(){1===this.trip_direction_id?this.fullTripDistance=t(2*this.distance):this.fullTripDistance=this.distance,this.revenueForTheTrip=t(this.unloadingVolume*this.unloadingPrice),this.costOfTheCargo=t(this.loadingVolume*this.loadingPrice),2===this.driver_salary_type_id?1===this.driver_salary_direction_id?this.driversSalaryForTheTrip=t(this.fullTripDistance*this.driver_salary/2):this.driversSalaryForTheTrip=t(this.fullTripDistance*this.driver_salary):1===this.driver_salary_type_id?this.driversSalaryForTheTrip=this.driver_salary:3===this.driver_salary_type_id&&(this.driversSalaryForTheTrip=t(this.driver_salary*this.unloading_volume)),this.driversSalaryForTheTrip=this.driver_salary,this.priceOfFuelForTheTrip=t(this.price_of_fuel*this.fullTripDistance*this.average_fuel_consumption/100),this.fixedOverhead=this.fixed_overhead,this.additionalOverhead=this.additional_overhead},calcResults:function(){this.revenueForTheTripWithoutVAT=this.revenueForTheTrip,this.costOfTheCargoWithoutVAT=this.costOfTheCargo,this.driversSalaryForTheTripWithoutVAT=this.driversSalaryForTheTrip,this.priceOfFuelForTheTripWithoutVAT=this.priceOfFuelForTheTrip,this.fixedOverheadWithoutVAT=this.fixedOverhead,this.additionalOverheadWithoutVAT=this.additionalOverhead,1===this.vat_in_income&&(this.revenueForTheTrip=t(this.revenueForTheTrip/1.2)),1===this.vat_in_cargo_expenses&&(this.costOfTheCargo=t(this.costOfTheCargo/1.2)),1===this.with_taxes&&(this.driversSalaryForTheTrip=t(1.432*this.driversSalaryForTheTrip)),1===this.vat_in_fuel_expenses&&(this.priceOfFuelForTheTrip=t(this.priceOfFuelForTheTrip/1.2)),1===this.vat_in_fixed_overhead&&(this.fixedOverhead=t(this.fixedOverhead/1.2)),1===this.vat_in_additional_overhead&&(this.additionalOverhead=t(this.additionalOverhead/1.2)),this.shippingCost=t((this.revenueForTheTrip/this.unloadingVolume-this.costOfTheCargo/this.unloadingVolume)/this.distance),this.profit=t(this.revenueForTheTrip-(this.costOfTheCargo+this.driversSalaryForTheTrip+this.priceOfFuelForTheTrip+this.additionalOverhead))},generateName:function(){var t=$("input[name=name]").attr("value");this.distance&&(t+="-"+this.distance),this.unloading_price&&(t+="-"+this.unloading_price),$("input[name=name]").val(t)},format:function(t,i){return(t?this.numberFormat.format(t):"-")+" "+(i||"руб.")},renderResults:function(){this.resultsEl.innerHTML="\t\t   <table>\t\t     <tr>\t\t\t    <td>Общий пробег за рейс: </td><td>"+this.format(this.fullTripDistance,"км")+"</td>\t\t\t </tr>\t\t\t <tr>\t\t\t    <td>Выручка за рейс: </td><td>"+this.format(this.revenueForTheTripWithoutVAT)+"</td>\t\t\t </tr>\t\t\t <tr>\t\t\t    <td>Затраты на покупку груза за рейс: </td><td>"+this.format(this.costOfTheCargoWithoutVAT)+"</td>\t\t\t </tr>             <tr style='display: none'>\t\t\t    <td>Заработная плата водителя ТС за рейс: </td><td>"+this.format(this.driversSalaryForTheTripWithoutVAT)+"</td>\t\t\t </tr>\t\t\t <tr>\t\t\t    <td>Цена топлива за рейс: </td><td>"+this.format(this.priceOfFuelForTheTripWithoutVAT)+"</td>\t\t\t </tr>\t\t\t <tr>\t\t\t    <td>Доп. накладные расходы на рейс: </td><td>"+this.format(this.additionalOverheadWithoutVAT)+"</td>\t\t\t </tr>\t\t\t <tr><td>&nbsp;</td><td>&nbsp;</td></tr>\t\t\t <tr>\t\t\t    <td>Цена доставки: </td><td>"+this.format(this.shippingCost,"куб.м/км")+"</td>\t\t\t </tr>\t\t\t <tr>\t\t\t    <td>Итого прибыль за рейс: </td><td>"+this.format(this.profit)+"</td>\t\t\t </tr>\t\t\t </table>"},fullRecalc:function(){this.recalcMain(),this.calcIntermediateResults(),this.calcResults(),this.generateName(),this.renderResults()}},new i(document.querySelector("form.create_edit_form"))}(),$(document).ready((function(){$(".without_profitability").click((function(){$.ajax({url:"/contract_without_profitability",data:$(".create_edit_form").serialize(),success:function(t){alert("Заказ успешно создан")},error:function(t){console.log("error")}})}))}))},1:function(t,i,e){t.exports=e("/JV1")}});